
@{
    this.ViewData["Title"] = "World Travel Forum - Comments";
}
@{
    Comment commentDetail = this.Model[0];
    var isLogged = Context.Session.Keys.Contains("LoggedUser");
    var loggedUserId = this.Context.Session.GetInt32("UserId");
    var isBlocked = Context.Session.GetString("IsBlocked");
}    
        <form asp-controller="Comments" asp-action="Index" method="get">
                | <a asp-controller="Home" asp-action="Index">@commentDetail.Post.Category.Name</a>
                > <a asp-controller="Posts" asp-action="Index">@commentDetail.Post.Title</a>
            <span style="margin-right:35%"></span>
            @if (isLogged & isBlocked != "True")
            {
            <label class="form-label"> Find user: </label>
            <input type="text" name="Username" placeholder="Username" />
            <input type="submit" value="Search" class="btn btn-primary" />
            <a asp-controller="Comments" asp-action="Create" asp-route-id="@commentDetail.PostId" class="btn btn-primary"> ADD A NEW COMMENT </a>
            }
        </form>
    
</br>
<div class="table">
    <div class="header">
        <div class="header-cell">Username</div>
        <div class="header-cell">Content</div>
    </div>

    @{
        foreach (var comment in this.Model)
        {
            <div class="row">
                <div class="cell">
                    Created by:<br/>
                    <a asp-controller="Users" asp-action="Index" asp-route-Username="@comment.CreatedBy.Username">@comment.CreatedBy.Username</a>
                    <br/>
                    @comment.DateTime
                </div>
                <div class="cell">
                @comment.Content
                <br/><br/>
                    @comment.LikesCount
                    @if (isLogged)
                    {
                        <a asp-controller="Comments" asp-action="Like" asp-route-id="@comment.Id" class="btn btn-warning">Like</a>
                    }
                    @if (isLogged & isBlocked != "True")
                    {
                     <a asp-controller="Comments" asp-action="CreateReply" asp-route-id="@comment.Id" class="btn btn-primary"> Reply </a>
                    }
                    @if(isLogged & comment.UserId==loggedUserId)
                    {
                     <a asp-controller="Comments" asp-action="Edit" asp-route-id="@comment.Id" class="btn btn-warning"> Edit </a>
                     <a asp-controller="Comments" asp-action="Delete" asp-route-id="@comment.Id" class="btn btn-danger"> Delete </a>
                    }
                    </div>
            </div>
        }
    }
</div>
@{
    string prevButtonState = this.Model.HasPrevPage ? "" : "disabled";
    string nextButtonState = this.Model.HasNextPage ? "" : "disabled";
}
<a asp-controller="Comment" asp-action="Index" asp-route-PostId="@commentDetail.PostId" asp-route-PageNumber="@(this.Model.PageNumber - 1)" class="btn btn-link @prevButtonState">Prev</a>
@{
    int currentPageNumber = this.Model.PageNumber;

    for (int i = 1; i <= this.Model.TotalPages; i++)
    {
        if (i == currentPageNumber)
        {
            <span>@i</span>
        }
        else
        {
            <span><a asp-controller="Comments" asp-action="Index"   asp-route-PageNumber="@i">@i</a></span>
        }
    }
}
<a asp-controller="Comments" asp-action="Index" asp-route-PostId="@commentDetail.PostId" asp-route-PageNumber="@(this.Model.PageNumber + 1)" class="btn btn-link @nextButtonState">Next</a>
